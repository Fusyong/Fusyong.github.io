<!DOCTYPE html>
<html lang="chinese (simplified)">
<head>
    <meta charset="utf-8">
    <title>嬉戏实验室 - Phaser3学习笔记</title>
    <meta name="description" content="">
    <meta name="author" content="黄复雄">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/theme/bootstrap.min.css" rel="stylesheet">
    <link href="/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="/theme/local.css" rel="stylesheet">
    <link href="/theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="/">嬉戏实验室</a>
        <div class="nav-collapse">
        <ul class="nav">

            <li><a href="http://www.xiiigame.com">XiiiGame</a></li>
            
            <li><a href="/pages/about.html">About</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
    <div class='article'>
        <div class="content-title">
            <h1>Phaser3学习笔记</h1>
2018-11-12 周一

	by 		<a class="url fn" href="/author/huang-fu-xiong.html">黄复雄.</a>
 


        </div>
	
        <div>
<h2 id="_1">说明</h2>
<ul>
<li>这是我学习Phaser3，尤其是API文档和官网实例的笔记，对于快速概览Phaser3的功能及其实现方法有帮助。Phaser3变化很大，与Phaser2不同的地方做了重点标记。<a href="/phaserguan-wang-shi-li-xue-xi-bi-ji.html">《Phaser2官网实例学习笔记》在这里。</a></li>
<li>如果你完全不了解Phaser，宜先学习官网入门教程，以便对框架结构有整体了解。</li>
<li>摘录的代码都是片段。我用的是TypeScript语言，但摘录的代码可能是JavaScript，或在此基础上添加了TypeScript类型标记。JavaScript代码在TypeScript中是有效的，但可能使编辑器、编译工具等报错——这跟设置有关。</li>
<li>同级的类往往有近似的属性和方法，所以通常只详记其中几个常用的。</li>
<li>条目中<code>@audio/HTML5 Audio/play audio file</code>一类标记，表示代码片段所摘自的自官网实例js文件的位置。并非每处都记出处。</li>
<li><strong>本文是随时更新的，</strong>最终会累积成一个便览手册；可通过搜索或底端的目录快速查找。</li>
</ul>
<h2 id="_2">学习资源</h2>
<ul>
<li><a href="https://phaser.io/tutorials/making-your-first-phaser-3-game/index">官网入门教程</a>。一个简明、完整的权威教程。</li>
<li><a href="https://github.com/photonstorm/phaser3-examples">Phaser3实例库</a>。可以在<a href="http://labs.phaser.io">labs.phaser.io</a>连线使用，但在我这里网速有问题。下载、安装后使用更方便，还可使用PowerGrep或FileLocator等高效的全文搜索软件在代码全文中检索。</li>
<li><a href="https://photonstorm.github.io/phaser3-docs/index.html">Phaser3在线文档</a>。快要完善了（2018-12-4还差不到800条）。可参考<a href="https://github.com/photonstorm/phaser3-docs">完整的文档库</a>。</li>
<li><a href="https://github.com/digitsensitive/phaser3-typescript">Phaser3-TypeScript模板与工具库</a>。包含工具和7个比较完整的游戏实例。</li>
<li><a href="https://github.com/littlee/wechat-small-game-phaser">wechat-small-game-phaser库</a>，这是一个使PhaserCE适配微信小游戏的库，但经实测，基本架构同样适用于Phaser3。</li>
<li><a href="https://www.cnblogs.com/honghong87/p/9592680.html">《phaser3 微信小游戏若干问题》</a>，解决Phaser3在微信中载入资源时不支持BLOB的问题（文章只解决了图片载入问题，其他资源载入问题需要照例自行修改Phaser3源码）。</li>
<li>我建的一个QQ群交流“Phaser3学习中心组”(938890881)。人气比较高的QQ群有<a href="https://www.phaser-china.com/">“Phaser小站”</a>(519413640)，“Pixi.js&amp;Phaser交流群”(384427721)</li>
</ul>
<h2 id="gamegameconfig">Game配置对象GameConfig</h2>
<p>Phaser3的配置对象包含很多项目，详见<a href="https://photonstorm.github.io/phaser3-docs/global.html#GameConfig">配置对象GameConfig文档</a>，也可参考<a href="https://github.com/digitsensitive/phaser3-typescript/blob/master/cheatsheets/game-config.md">小抄</a>。</p>
<p><strong>Phaser3广泛使用配置对象，又比如在生成Sprites、Tweens实例时。</strong></p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">AUTO</span><span class="p">,</span>
    <span class="nx">width</span><span class="o">:</span> <span class="mi">800</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mi">600</span><span class="p">,</span>
    <span class="nx">physics</span><span class="o">:</span> <span class="p">{</span>
        <span class="k">default</span><span class="o">:</span> <span class="s1">'arcade'</span><span class="p">,</span>
        <span class="nx">arcade</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">gravity</span><span class="o">:</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">300</span> <span class="p">},</span>
            <span class="nx">debug</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">scene</span><span class="o">:</span> <span class="p">{</span> <span class="c1">// 第一个场景自动运行，其余场景除非标有{ active: true }，否则不会自动运行</span>
        <span class="nx">preload</span><span class="o">:</span> <span class="nx">preload</span><span class="p">,</span> <span class="c1">// 资源加载场景</span>
        <span class="nx">create</span><span class="o">:</span> <span class="nx">create</span><span class="p">,</span>  <span class="c1">// 内容生成场景</span>
        <span class="nx">update</span><span class="o">:</span> <span class="nx">update</span>  <span class="c1">// 逐帧更新/循环处理的内容，如键盘、鼠标监控</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="c1">// **Phaser2的Game实例是通往内部系统的入口，Phaser3不再是这样，因此保存在全局变量中保存实例没有实际意义。**</span>
<span class="kd">var</span> <span class="nx">game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Game</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">preload</span> <span class="p">(){}</span>
<span class="kd">function</span> <span class="nx">create</span> <span class="p">(){}</span>
<span class="kd">function</span> <span class="nx">update</span> <span class="p">(){}</span>
</pre></div>
<h2 id="gameobjects">GameObjects游戏对象</h2>
<p><strong>Phaser3游戏对象的一个重要变化，是把Sprite、Text、Group等游戏对象的容器功能分离出来，归到Container中。这样一来，Sprite、Text等不能添加子项，Group有子项，但实际是逻辑分组，非独占，也不能整体地控制显示状态。</strong>Phaser2的渲染核心是PIXI，PIXI有Container，但在Phaser2中一般不直接使用。</p>
<h3 id="sprite">Sprite精灵</h3>
<p>精灵是Phaser游戏中最主要的游戏对象，在游戏对象中有代表性。要便览精灵的属性和方法，请参考<a href="/phaser3-apiwen-dang-da-gang-sprite.html">《Phaser3 API文档大纲-Sprite》</a>。</p>
<div class="highlight"><pre><span></span>let newSprite = this.add.sprite(20, 30, "spriteTexture", 2);
</pre></div>
<p>参考小抄<a href="https://github.com/digitsensitive/phaser3-typescript/blob/master/cheatsheets/gameobjects/sprite.md">Phaser.GameObject.Sprite</a></p>
<h4>Size内部尺寸</h4>
<p>Size内部尺寸、原本（native）尺寸，包括：</p>
<ul>
<li>Sprite.width</li>
<li>Sprite.height</li>
</ul>
<p>改变内部尺寸，供帧或物理体生成之用，不会影响已经渲染的游戏对象的尺寸：</p>
<ul>
<li>Sprite.setSize(width, height)</li>
</ul>
<h4>DisplaySize显示尺寸^[good]</h4>
<ul>
<li>Sprite.displayWidth</li>
<li>Sprite.displayHeight</li>
</ul>
<p>有两个方法改变显示尺寸:</p>
<ul>
<li>Sprite.setScale(x [, y])</li>
<li>Sprite.setDisplaySize(width, height) </li>
</ul>
<h4>PathFollower循路精灵</h4>
<p>在一个路径上运动的精灵，是Sprite的子类。</p>
<h4>直接生成有物理属性的精灵</h4>
<div class="highlight"><pre><span></span>player = this.physics.add.sprite(100, 450, 'dude');
player.setBounce(0.2); // 设置反弹
player.setCollideWorldBounds(true);  // 设置与世界边缘碰撞
player.body.setGravityY(300) // 物理精灵的body包含了物理属性
player.setTint(0xff0000); // 着色
</pre></div>
<h3 id="image">Image图像</h3>
<p>图像与精灵的不同主要在于，Image没有动画（Animation）组件。——注意：Tween（补间运动）不属于Animation。
<strong>在Phaser2中，Image的操控项更少，尤其是没有物理属性。</strong></p>
<p><strong>Phaser3游戏对象的原点（对应于Phaser2的锚点anchor属性）默认为中心点，而不是左上角。</strong>原点通过属性<code>originX</code>, <code>originY</code>获取，通过方法<code>setOrigin(x, y)</code>设置。</p>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">'sky'</span><span class="p">);</span>  <span class="c1">// 指定原点/中心点位置位置</span>
<span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"background"</span><span class="p">);</span> <span class="c1">// 居中放置</span>
<span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'sky'</span><span class="p">).</span><span class="nx">setOrigin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// 设左上角为原点/锚点</span>
</pre></div>
<p>参考小抄<a href="https://github.com/digitsensitive/phaser3-typescript/blob/master/cheatsheets/gameobjects/image.md">Phaser.GameObject.Image</a></p>
<h3 id="shape">Shape几何图形和基于几何图形的游戏对象子类</h3>
<p>Shape本身不能加到场景上，而是用作下列几何图形游戏对象的基类：</p>
<ul>
<li>Arc弧形</li>
<li>Curve曲线形</li>
<li>Ellipse椭圆（包括正圆）</li>
<li>Grid栅格</li>
<li>IsoBox等距(isometric)方体</li>
<li>IsoTriangle等距三角体（四面体）</li>
<li>Line线条（包括三角形、梯形）</li>
<li>Polygon多边形</li>
<li>Rectangle方形</li>
<li>Start星形</li>
<li>Triangle三角形</li>
</ul>
<h3 id="graphics">Graphics图形</h3>
<p>用于向场景中绘制简单图形。比Shape子类的可控项少。</p>
<div class="highlight"><pre><span></span><span class="c1">// 绘制圆角方形</span>
<span class="kd">var</span> <span class="nx">graphics</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">graphics</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="mh">0xffff00</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fillRoundedRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</pre></div>
<p><strong>绘制矢量图形很消耗算力。如果图形变化不多，可生成纹理<code>generateTexture</code>后作为图像渲染。</strong></p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">graphics</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">make</span><span class="p">.</span><span class="nx">graphics</span><span class="p">().</span><span class="nx">fillStyle</span><span class="p">(</span><span class="mh">0x00ff00</span><span class="p">).</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">generateTexture</span><span class="p">(</span><span class="s1">'hudbar'</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">'hudbar'</span><span class="p">);</span>
</pre></div>
<h3 id="text">Text文本</h3>
<p>文本所用字体必须是浏览器已经可以取用的，或已经载入，或已经嵌入CSS中。
<strong>任何内容和格式变动都需要整体重置，因此很消耗算力。使用BitmapText会好很多。</strong></p>
<div class="highlight"><pre><span></span><span class="nt">var</span> <span class="nt">scoreText</span> <span class="o">=</span> <span class="nt">this</span><span class="p">.</span><span class="nc">add</span><span class="p">.</span><span class="nc">text</span><span class="o">(</span><span class="nt">16</span><span class="o">,</span> <span class="nt">16</span><span class="o">,</span> <span class="s1">'score: 0'</span><span class="o">,</span> <span class="p">{</span> <span class="n">fontSize</span><span class="p">:</span> <span class="s1">'32px'</span><span class="p">,</span> <span class="kc">fill</span><span class="o">:</span> <span class="s1">'#000'</span> <span class="p">}</span><span class="o">);</span>
<span class="nt">scoreText</span><span class="p">.</span><span class="nc">setText</span><span class="o">(</span><span class="s1">'Score: '</span> <span class="o">+</span> <span class="nt">10</span><span class="o">);</span>
</pre></div>
<h3 id="bitmaptext">BitmapText静态位图文本</h3>
<p>BitmapText的灵活性不如Text，但速度更快。
生成工具：
<em> <a href="http://www.angelcode.com/products/bmfont/">BMFont (Windows, free)</a>
</em> <a href="http://www.71squared.com/en/glyphdesigner">Glyph Designer (OS X, commercial)</a>
* <a href="http://kvazars.com/littera/">Littera (Web-based, free)</a></p>
<p>推荐使用XML格式，如果使用JSON格式，必须符合X2JS库的转换标准。<a href="http://codebeautify.org/xmltojson">这里有在线工具。</a></p>
<h3 id="dynamicbitmaptext">DynamicBitmapText动态位图文本</h3>
<p>渲染时逐个字处理，因此比静态位图文本更灵活，比如阴影、填充效果，可以使用web字体，但也更消耗资源。</p>
<h3 id="zone">Zone区块</h3>
<p>Zone是一个矩形区块，没有纹理，不显示，但存在于与显示列表中，有游戏对象的一般属性。主要用做点击、角色变动的定位，或重叠检测，或作为非显示对象的基类。</p>
<h4>TileSprite瓦片精灵</h4>
<p>用小块Tile铺设背景。</p>
<h4>Sprite3D</h4>
<h3 id="rendertexture">RenderTexture渲染器纹理</h3>
<p>能够在运行时绘制多个游戏对象，实时生成纹理，以供他用。对webGL友好，不激发GPU加载。</p>
<h3 id="blitterbob">Blitter位块传送器（Bob容器）</h3>
<h4>Bob</h4>
<p>Blitter是为定制特效系统准备的容器，有很高的渲染效率；Blitter管理Bob，Bob有不能变形、旋转等限制。</p>
<h3 id="container"><a href="/phaser3-apiwen-dang-da-gang-container.html">Container容器</a></h3>
<p>参考<code>Group</code>。</p>
<h3 id="group"><a href="/phaser3-apiwen-dang-da-gang-group.html">Group组</a></h3>
<p>Group是一个抽象分组，便于批量地生成、排布、控制、循环处理近似游戏对象。与Container不同，它自身没有没有显隐、缩放、定位、旋转属性（但可以快速控制子项的这些属性）。他对子项不是独占的，子项可以存在于多个组中。因此<strong>Container更适于把多个显示对象集合成一个复合型显示对象，以便整体地控制显示状态；Group则适合于对近似对象进行批量操作。</strong></p>
<p><strong>组的一个重要用途是对象池。（？？）</strong></p>
<h4>生成静态物理组</h4>
<div class="highlight"><pre><span></span>var platforms;
platforms = this.physics.add.staticGroup(); // 物理静态组
platforms.create(400, 568, 'ground').setScale(2).refreshBody();  // 物理静态组变换尺寸后需要刷新物理Body，即通知物理系统
platforms.create(600, 400, 'ground');
platforms.create(50, 250, 'ground');
platforms.create(750, 220, 'ground');
</pre></div>
<h4>生成动态物理组</h4>
<div class="highlight"><pre><span></span>stars = this.physics.add.group({
    key: 'star',
    repeat: 11,
    setXY: { x: 12, y: 0, stepX: 70 } // 生成一个行列
});

stars.children.iterate(function (child) {  // 组内遍历、随机赋值
    child.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));

});
</pre></div>
<h3 id="mesh">Mesh网格</h3>
<p><strong>Mesh/网格是Phaser3新增功能，只支持webGL渲染模式。Phaser2不支持Mesh，因此也不支持Drangonbone等动画格式中的网格蒙皮功能。</strong></p>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">newMesh</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">mesh</span><span class="p">(</span>
  <span class="mi">300</span><span class="p">,</span>
  <span class="mi">300</span><span class="p">,</span>
  <span class="p">[</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">],</span>
  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s2">"texture"</span>
<span class="p">);</span>
</pre></div>
<p>Parameters</p>
<div class="highlight"><pre><span></span><span class="n">x</span>                    <span class="o">:</span> <span class="n">the</span> <span class="n">x</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">mesh</span>
<span class="n">y</span>                    <span class="o">:</span> <span class="n">the</span> <span class="n">y</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">mesh</span>
<span class="n">vertices</span>             <span class="o">:</span> <span class="n">array</span> <span class="n">of</span> <span class="n">x</span> <span class="n">and</span> <span class="n">y</span> <span class="n">positions</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">center</span> <span class="n">of</span> <span class="n">mesh</span> <span class="n">object</span>
<span class="n">uv</span>                   <span class="o">:</span> <span class="n">mapping</span> <span class="n">of</span> <span class="n">the</span> <span class="n">uv</span> <span class="n">coordinates</span>
<span class="n">colors</span>               <span class="o">:</span> <span class="n">array</span> <span class="n">of</span> <span class="n">colors</span> <span class="k">for</span> <span class="k">each</span> <span class="n">uv</span> <span class="n">texture</span> <span class="n">coordinate</span>
<span class="n">alphas</span>               <span class="o">:</span> <span class="n">array</span> <span class="n">of</span> <span class="n">alphas</span> <span class="k">for</span> <span class="k">each</span> <span class="n">uv</span> <span class="n">texture</span> <span class="n">coordinate</span>
<span class="n">texture</span>              <span class="o">:</span> <span class="n">sprite</span> <span class="n">name</span>
<span class="n">frame</span>                <span class="o">:</span> <span class="n">the</span> <span class="n">sprite</span> <span class="n">frame</span>
</pre></div>
<p>通过<code>newMesh.vertices[0]</code>、<code>newMesh.uv[0]</code>等引用、操作。</p>
<p>参考小抄 <a href="https://github.com/digitsensitive/phaser3-typescript/blob/master/cheatsheets/gameobjects/mesh.md">Phaser.GameObject.Mesh</a></p>
<h2 id="input">Input游戏对象的输入控制</h2>
<ul>
<li>GameObject.setInteractive( [shape] [, callback] [, dropZone])</li>
</ul>
<p>开启交互，生成交互游戏对象，即把此对象传给输入管理器，以开启输入。
点击区域（hitArea）默认是基于游戏对象纹理生成的正方形；
没有绑定纹理的游戏对象（如Graphics、BitmapText）则需要传递一个shape（配置对象或geometric shape），这时候还需要传递回调函数。
回调函数要能接收三个变量，并返回表示击中与否的布尔值：<code>callback(hitArea, x, y): boolean</code>。比较常用的一类是几何图形的静态函数<code>Contains</code>，如<code>Phaser.Geom.Rectangle.Contains</code>(<code>&lt;static&gt; Contains(rect, x, y)</code>)。</p>
<div class="highlight"><pre><span></span><span class="nx">text</span><span class="p">.</span><span class="nx">setInteractive</span><span class="p">(</span><span class="k">new</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Geom</span><span class="p">.</span><span class="nx">Rectangle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">text</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">text</span><span class="p">.</span><span class="nx">height</span><span class="p">),</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Geom</span><span class="p">.</span><span class="nx">Rectangle</span><span class="p">.</span><span class="nx">Contains</span><span class="p">);</span>
<span class="c1">//  Input Event listeners</span>
<span class="c1">// this: Phaser.Scene</span>
<span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'gameobjectover'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">gameObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">gameObject</span><span class="p">.</span><span class="nx">setTint</span><span class="p">(</span><span class="mh">0xff0000</span><span class="p">,</span> <span class="mh">0xff0000</span><span class="p">,</span> <span class="mh">0xffff00</span><span class="p">,</span> <span class="mh">0xff00ff</span><span class="p">);</span>
<span class="p">});</span>
<span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'gameobjectout'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">gameObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">gameObject</span><span class="p">.</span><span class="nx">clearTint</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
<ul>
<li>GameObject.removeInteractive()</li>
</ul>
<p>移除交互游戏对象。不是即时的，是在the next game step。</p>
<ul>
<li>GameObject.disableInteractive()</li>
</ul>
<p>临时禁用。</p>
<ul>
<li>GameObject.input.hitArea.setSize(width, height)</li>
</ul>
<p>设置击中区域（默认方形）。</p>
<ul>
<li>GameObject.input</li>
</ul>
<p>此属性用以保存交互对象。</p>
<p><a href="https://phaser.io/phaser3/devlog/89">Input问题，可参考开发日志。</a></p>
<h2 id="scene">Scene场景</h2>
<p>Phaser3的Scene源于Phaser2的State，并包含Phaser2的Game World（游戏对象的生存世界）。
一个完整游戏，在正式游戏场景前常有boot、preload、menu等场景。场景控制细节见Scene.scene。
场景类的结构通常是：</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">SimpleScene</span> <span class="kr">extends</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Scene</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">(</span>
                <span class="p">{</span>
                <span class="nx">key</span><span class="o">:</span> <span class="s2">"myScene"</span><span class="p">,</span>
                <span class="nx">physics</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">arcade</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">gravity</span><span class="o">:</span> <span class="p">{</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">200</span> <span class="p">}</span>
                    <span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="nx">preload</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="nx">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>SceneConfig场景配置对象参考<a href="https://github.com/digitsensitive/phaser3-typescript/blob/master/cheatsheets/scene-config.md">SceneConfig小抄</a></p>
<h3 id="sceneadd">Scene.add属性</h3>
<p>实际指向游戏对象工厂函数Phaser.GameObjects.GameObjectFactory，其下的方法通过多个参数生成、添加游戏对象。</p>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">'gems'</span><span class="p">)</span>
</pre></div>
<ul>
<li>Members</li>
<li>displayList :Phaser.GameObjects.DisplayList</li>
<li>scene :Phaser.Scene</li>
<li>systems :Phaser.Scenes.Systems</li>
<li>updateList :Phaser.GameObjects.UpdateList</li>
<li>Methods</li>
<li>existing(child)</li>
</ul>
<p><strong>添加已有的游戏对象，比如不能用<code>add</code>/<code>make</code>而只能用<code>new</code>生成的客户定制类的实例。</strong>
  如有必要，会添加到显示列表DisplayList和更新列表UpdateList。</p>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">missile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Missile</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="s1">'blue-missile'</span><span class="p">);</span>  
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">existing</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">missile</span><span class="p">);</span>
</pre></div>
<ul>
<li>各种游戏对象GameObjects生成器（类名对应的小写形式）</li>
</ul>
<p><strong>对比<code>add</code>、<code>make</code>、<code>new</code>三者的差异：</strong></p>
<div class="highlight"><pre><span></span><span class="c1">// add生成后自动添加到显示列表</span>
<span class="kr">const</span> <span class="nx">text1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">'image1'</span><span class="p">);</span>
<span class="c1">// new生成后手动添加到显示列表</span>
<span class="kr">const</span> <span class="nx">text2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">GameObjects</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"image2"</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">existing</span><span class="p">(</span><span class="nx">text2</span><span class="p">);</span>
<span class="c1">// make通过配置对象生成实例，通过设置`add: boolean`决定是否立即添加到显示列表（缺省添加）</span>
<span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">make</span><span class="p">.</span><span class="nx">text</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">text</span><span class="o">:</span> <span class="s2">"显示文本"</span><span class="p">,</span> <span class="nx">style</span><span class="o">:</span> <span class="p">{</span> <span class="nx">fontFamily</span><span class="o">:</span> <span class="s1">'楷体'</span><span class="p">,</span> <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">64</span><span class="p">,</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">color</span> <span class="p">}},</span> <span class="nx">ture</span><span class="p">)</span>
<span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">make</span><span class="p">.</span><span class="nx">sprite</span><span class="p">({</span><span class="nx">key</span><span class="o">:</span><span class="s1">'logo'</span><span class="p">,</span> <span class="nx">add</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
</pre></div>
<ul>
<li>particles粒子</li>
<li>path路径</li>
<li>quad四边框子。一个预配置的网格（Mesh）游戏对象，由两个三角形/四条边控制一个纹理的变形。</li>
<li>renderTexture渲染纹理</li>
<li>tween补间动画</li>
</ul>
<h3 id="scenemake">Scene.make属性</h3>
<p>参考<code>Scene.add</code>。
实际指向游戏对象生成函数Phaser.GameObjects.GameObjectCreator。成员与方法的名称与<code>add</code>属性的的相同；但与<code>add</code>不同，<code>make</code>下的方法通过一个<strong>配置对象</strong>生成游戏对象，并通过变量控制是否添加到显示列表。</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bunny</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">make</span><span class="p">.</span><span class="nx">sprite</span><span class="p">({</span>
    <span class="nx">x</span><span class="o">:</span> <span class="nx">game</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> 
    <span class="nx">y</span><span class="o">:</span> <span class="nx">game</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> 
    <span class="nx">key</span><span class="o">:</span> <span class="s1">'bunny'</span><span class="p">,</span>
    <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="nx">ture</span><span class="p">);</span>
</pre></div>
<h3 id="scenechildren">Scene.children显示列表</h3>
<h3 id="sceneanims">Scene.anims动画管理器</h3>
<p><strong>Phaser3生成的动画是全局的，可以应用到不同的对象上。</strong></p>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">anims</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">'left'</span><span class="p">,</span> <span class="c1">// 动画的键值，通过此键值应用动画</span>
    <span class="nx">frames</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">anims</span><span class="p">.</span><span class="nx">generateFrameNumbers</span><span class="p">(</span><span class="s1">'dude'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">start</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span> <span class="mi">3</span> <span class="p">}),</span>
    <span class="nx">frameRate</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nx">repeat</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="p">});</span>

<span class="k">this</span><span class="p">.</span><span class="nx">anims</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">'turn'</span><span class="p">,</span>
    <span class="nx">frames</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">'dude'</span><span class="p">,</span> <span class="nx">frame</span><span class="o">:</span> <span class="mi">4</span> <span class="p">}</span> <span class="p">],</span>
    <span class="nx">frameRate</span><span class="o">:</span> <span class="mi">20</span>
<span class="p">});</span>

<span class="nx">player</span><span class="p">.</span><span class="nx">anims</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'left'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
<h3 id="scenetime">Scene.time时钟</h3>
<h3 id="scenetweens">Scene.tweens补间动画管理器</h3>
<h3 id="scenecache">Scene.cache缓存管理器</h3>
<p>指向<a href="https://photonstorm.github.io/phaser3-docs/Phaser.Cache.CacheManager.html">缓存管理器Phaser.Cache.CacheManager</a>。
生成游戏实例的全局缓存，其中的每个<a href="https://photonstorm.github.io/phaser3-docs/Phaser.Cache.BaseCache.html">BaseCache</a>实例管理一类已经加载的文件。</p>
<p>@\cache\json file</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">preload</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="s1">'jsonData'</span><span class="p">,</span> <span class="s1">'assets/atlas/megaset-0.json'</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'jsonData'</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
<h4>Phaser.Cache.CacheManager的成员和方法</h4>
<ul>
<li>Members<ul>
<li>audio :Phaser.Cache.BaseCache</li>
<li>binary :Phaser.Cache.BaseCache</li>
<li>bitmapFont :Phaser.Cache.BaseCache</li>
<li>custom :Object.<phaser.cache.basecache> 包含自定义BaseCache条目的对象</phaser.cache.basecache></li>
<li><protected> game :Phaser.Game 指向自身所属的Game实例</protected></li>
<li>html :Phaser.Cache.BaseCache</li>
<li>json :Phaser.Cache.BaseCache</li>
<li>obj :Phaser.Cache.BaseCache 存放加载的WaveFront OBJ文件</li>
<li>physics :Phaser.Cache.BaseCache 存放（如加载的）物理学数据</li>
<li>shader :Phaser.Cache.BaseCache</li>
<li>text :Phaser.Cache.BaseCache</li>
<li>tilemap :Phaser.Cache.BaseCache</li>
<li>xml :Phaser.Cache.BaseCache</li>
</ul>
</li>
<li>Methods<ul>
<li>addCustom(key)添加自定义键（通过Cache.custom.key取用）</li>
<li>destroy()销毁所有缓存</li>
</ul>
</li>
</ul>
<h4>Phaser.Cache.BaseCache的成员和方法</h4>
<ul>
<li>Members<ul>
<li>entries :Phaser.Structs.Map.<string, *=""></string,></li>
<li>events :Phaser.Events.EventEmitter</li>
</ul>
</li>
<li>Methods<ul>
<li>add(key, data)</li>
<li>destroy() 销毁本缓存</li>
<li>exists(key) 判断键值存在与否（与<code>BaseCache.has</code>的行为一致）</li>
<li>get(key)</li>
<li>has(key) 与<code>BaseCache.exists</code>的行为一致。</li>
<li>remove(key)</li>
</ul>
</li>
<li>Events<ul>
<li>addEvent 条目增添事件</li>
<li>removeEvent 条目移除事件</li>
</ul>
</li>
</ul>
<h3 id="scenecameras">Scene.cameras镜头管理器</h3>
<h3 id="sceneevents">Scene.events事件发生器</h3>
<h3 id="scenegamegame">Scene.game(Game)</h3>
<h3 id="sceneinput">Scene.input输入插件</h3>
<h3 id="scenelights">Scene.lights灯光管理器</h3>
<h3 id="sceneload"><a href="/phaser3-apiwen-dang-da-gang-loaderloaderplugin.html">Scene.load资源加载插件</a></h3>
<p>@loader/game load config</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">preload</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">progress</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">graphics</span><span class="p">();</span>
    <span class="c1">// 设置'progress'事件的回调函数（绘制进度条）</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'progress'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">progress</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="nx">progress</span><span class="p">.</span><span class="nx">fillStyle</span><span class="p">(</span><span class="mh">0xffffff</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nx">progress</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">800</span> <span class="o">*</span> <span class="nx">value</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// 销毁进度条</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">progress</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="c1">//  Now let's load a huge stack of files!</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="s1">'128x128'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="s1">'sky'</span><span class="p">,</span> <span class="s1">'assets/sky.png'</span><span class="p">);</span>  <span class="c1">// 'sky'是载入后资源的关键字，用以获取资源</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">spritesheet</span><span class="p">(</span><span class="s1">'dude'</span><span class="p">,</span> 
        <span class="s1">'assets/dude.png'</span><span class="p">,</span>
        <span class="p">{</span> <span class="nx">frameWidth</span><span class="o">:</span> <span class="mi">32</span><span class="p">,</span> <span class="nx">frameHeight</span><span class="o">:</span> <span class="mi">48</span> <span class="p">}</span>
    <span class="p">);</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
<h3 id="sceneimpact-impact">Scene.impact Impact物理引擎</h3>
<h3 id="scenematter-zatter">Scene.matter Zatter物理引擎</h3>
<h3 id="scenephysics-arcade">Scene.physics Arcade物理引擎</h3>
<h3 id="sceneplugins">Scene.plugins插件管理器</h3>
<h3 id="scenefacebook-facebook">Scene.facebook Facebook即时游戏插件</h3>
<h3 id="sceneregistry">Scene.registry数据管理器</h3>
<h3 id="scenedata">Scene.data数据管理器</h3>
<h3 id="scenescene">Scene.scene场景插件</h3>
<p>指向场景插件ScenePlugin。
管理各场景，如用<code>start</code>停止本场景并启动新场景，或用<code>launch</code>并行启动UI场景，或<code>pause</code>、<code>resume</code>、<code>stop</code>本场景。
场景间的层级管理可用方法有：<code>bringToTop</code>, <code>sendToBack</code>, <code>moveUp</code>, <code>moveDown</code>, <code>moveAbove</code>, <code>moveBelow</code>。
场景间通信，先建立引用<code>this.scene.get('SceneB')</code>，如果结合紧密则直接调用方法，如果关系不紧密则监听事件。
参考<a href="https://photonstorm.github.io/phaser3-docs/Phaser.Scenes.ScenePlugin.html">API文档中的Phaser.Scenes.ScenePlugin</a>、
<a href="https://github.com/jdotrjs/phaser-guides/blob/master/Basics/Part3.md">Let's Talk About Scenes</a>、
<a href="https://gist.github.com/samme/01a33324a427f626254c1a4da7f9b6a3">phaser-scenes-summary</a></p>
<h3 id="scenesound">Scene.sound基础声音管理器</h3>
<p>@audio/HTML5 Audio/play audio file</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">preload</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">audio</span><span class="p">(</span><span class="s1">'theme'</span><span class="p">,</span> <span class="p">[</span> <span class="c1">// 一组可选文件</span>
        <span class="s1">'assets/audio/oedipus_wizball_highscore.ogg'</span><span class="p">,</span>
        <span class="s1">'assets/audio/oedipus_wizball_highscore.mp3'</span>
    <span class="p">]);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">create</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">music</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sound</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'theme'</span><span class="p">);</span>
    <span class="nx">music</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
<h3 id="scenesys">Scene.sys系统</h3>
<div class="highlight"><pre><span></span><span class="c1">// 画布宽高</span>
<span class="kd">let</span> <span class="nx">w</span>: <span class="kt">number</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">h</span>: <span class="kt">number</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
<span class="c1">// 判断不是桌面系统，而是移动系统</span>
<span class="kd">let</span> <span class="nx">isDesktop</span>: <span class="kt">boolean</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scene</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">device</span><span class="p">.</span><span class="nx">os</span><span class="p">.</span><span class="nx">desktop</span><span class="p">;</span>
</pre></div>
<h3 id="scenetextures">Scene.textures纹理管理器</h3>
<div class="highlight"><pre><span></span><span class="c1">// 获取文理管理器中所有纹理的key(数组)</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">textures</span><span class="p">.</span><span class="nx">getTextureKeys</span><span class="p">();</span>
</pre></div>
<h2 id="_3">生成碰撞、重叠管理对象</h2>
<div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">physics</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">collider</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">platforms</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">physics</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">collider</span><span class="p">(</span><span class="nx">stars</span><span class="p">,</span> <span class="nx">platforms</span><span class="p">);</span> <span class="c1">// 组与组碰撞</span>

<span class="k">this</span><span class="p">.</span><span class="nx">physics</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">overlap</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">stars</span><span class="p">,</span> <span class="nx">collectStar</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">collectStar</span> <span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">star</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">star</span><span class="p">.</span><span class="nx">disableBody</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> 
<span class="p">}</span>
</pre></div>
<h2 id="input_1">Input生成输入管理对象</h2>
<div class="highlight"><pre><span></span><span class="nx">cursors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">.</span><span class="nx">createCursorKeys</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">cursors</span><span class="p">.</span><span class="nx">left</span><span class="p">.</span><span class="nx">isDown</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setVelocityX</span><span class="p">(</span><span class="o">-</span><span class="mi">160</span><span class="p">);</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">anims</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">'left'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cursors</span><span class="p">.</span><span class="nx">right</span><span class="p">.</span><span class="nx">isDown</span><span class="p">){}</span>
<span class="k">else</span><span class="p">{}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">cursors</span><span class="p">.</span><span class="nx">up</span><span class="p">.</span><span class="nx">isDown</span> <span class="o">&amp;&amp;</span> <span class="nx">player</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">touching</span><span class="p">.</span><span class="nx">down</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">player</span><span class="p">.</span><span class="nx">setVelocityY</span><span class="p">(</span><span class="o">-</span><span class="mi">330</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<h2 id="gameresize">调整尺寸Game.resize</h2>
<p>根据浏览器窗口变动调整尺寸。</p>
<div class="highlight"><pre><span></span><span class="nb">window</span><span class="p">.</span><span class="nx">onresize</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">game</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<h2 id="game">销毁Game实例</h2>
<div class="highlight"><pre><span></span><span class="nx">Game</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">removeCanvas</span> <span class="p">[,</span> <span class="nx">noReturn</span><span class="p">])</span>
</pre></div>
<h2 id="src">src文件结构（最佳实践）</h2>
<div class="highlight"><pre><span></span><span class="nx">src</span>
<span class="o">|</span>   <span class="nx">phaser</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">ts</span>  <span class="c1">// Phaser类型声明文件，Typescript编译器需要</span>
<span class="o">|</span>   <span class="nx">main</span><span class="p">.</span><span class="nx">ts</span>      <span class="c1">// web版入口文件</span>
<span class="o">|</span>   <span class="nx">game</span><span class="p">.</span><span class="nx">ts</span>      <span class="c1">// 微信版入口文件</span>
<span class="o">|</span>   
<span class="o">+---</span><span class="kr">const</span>        <span class="c1">// 存放配置常量</span>
<span class="o">|</span>       
<span class="o">+---</span><span class="nx">js</span>           <span class="c1">// 存放js库，比如微信适配用的</span>
<span class="o">|</span>           
<span class="o">+---</span><span class="nx">objects</span>      <span class="c1">// 存放游戏对象类</span>
<span class="o">|</span>       
<span class="err">\</span><span class="o">---</span><span class="nx">scenes</span>       <span class="c1">// 存放场景类</span>
        <span class="nx">BootScene</span><span class="p">.</span><span class="nx">ts</span>       <span class="c1">// 启动，为生成载入场景预备必要资源（尽可能少）</span>
        <span class="nx">PreloadScene</span><span class="p">.</span><span class="nx">ts</span>    <span class="c1">// 载入各场景通用资源，显示载入动画</span>
        <span class="nx">MainMenuScene</span><span class="p">.</span><span class="nx">ts</span>   <span class="c1">// 游戏菜单</span>
        <span class="nx">GameScene</span><span class="p">.</span><span class="nx">ts</span>       <span class="c1">// 游戏场景</span>
</pre></div>
<p>另外，如果不使用webpack等打包工具，<code>index.html</code>文件和资源文件夹<code>assets/</code>可以跟入口文件<code>main.ts</code>放在同一层级（即<code>src/</code>)。</p>
<p>微信版需要单建一个项目文件夹，存放微信小游戏必须的文件<code>game.js</code>（<code>game.ts</code>的编译目标）、<code>game.json</code>、<code>project.config.json</code>，以及<code>assets/</code>、<code>js/</code>等资源。微信版的问题当专文说明。</p>
<h2 id="math">Math数学</h2>
<h3 id="rnd">RND随机数</h3>
<ul>
<li>随机取选取列表中的项目</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">nouns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ninja"</span><span class="p">,</span> <span class="s2">"chair"</span><span class="p">,</span> <span class="s2">"pancake"</span><span class="p">]</span>
<span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">RND</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">nouns</span><span class="p">);</span>
</pre></div>
<h2 id="_4">对象对齐（定位）</h2>
<p>常用四个类中的静态方法：</p>
<ul>
<li><a href="/phaser3-apiwen-dang-da-gang-displayaligninto.html">Display.Align中的In和To</a></li>
<li><a href="/phaser3-apiwen-dang-da-gang-displaybounds.html">Display.Bounds</a></li>
<li><a href="/phaser3-apiwen-dang-da-gang-actions.html">Actions.GridAlign中的静态方法GridAlign、PlaceOn系列、Inc系列，Set系列，等等)</a></li>
</ul>
<h2 id="actions"><a href="/phaser3-apiwen-dang-da-gang-actions.html">Actions动作（批处理）</a></h2>
<p><code>Phaser. Actions</code>包含一组静态方法，可以对一组游戏对象进行批量处理，应用相同的动作。常常结合逻辑分组<code>Group.getChildren()</code>一起使用。
条目要包含要处理的属性、方法，否则无效。</p>
<p>@actions\place on circle.js</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phaser</span><span class="p">.</span><span class="nx">Geom</span><span class="p">.</span><span class="nx">Circle</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">260</span><span class="p">);</span>
<span class="nx">group</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">'ball'</span><span class="p">,</span> <span class="nx">frameQuantity</span><span class="o">:</span> <span class="mi">32</span> <span class="p">});</span>
<span class="c1">// 把组中游戏对象放置在圆环上</span>
<span class="nx">Phaser</span><span class="p">.</span><span class="nx">Actions</span><span class="p">.</span><span class="nx">PlaceOnCircle</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">(),</span> <span class="nx">circle</span><span class="p">);</span>
</pre></div></div>
	
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                TOC
                </li>
                <nav class="toc">
                    <div class="toc">
<ul>
<li><a href="#_1">说明</a></li>
<li><a href="#_2">学习资源</a></li>
<li><a href="#gamegameconfig">Game配置对象GameConfig</a></li>
<li><a href="#gameobjects">GameObjects游戏对象</a><ul>
<li><a href="#sprite">Sprite精灵</a></li>
<li><a href="#image">Image图像</a></li>
<li><a href="#shape">Shape几何图形和基于几何图形的游戏对象子类</a></li>
<li><a href="#graphics">Graphics图形</a></li>
<li><a href="#text">Text文本</a></li>
<li><a href="#bitmaptext">BitmapText静态位图文本</a></li>
<li><a href="#dynamicbitmaptext">DynamicBitmapText动态位图文本</a></li>
<li><a href="#zone">Zone区块</a></li>
<li><a href="#rendertexture">RenderTexture渲染器纹理</a></li>
<li><a href="#blitterbob">Blitter位块传送器（Bob容器）</a></li>
<li><a href="#container">Container容器</a></li>
<li><a href="#group">Group组</a></li>
<li><a href="#mesh">Mesh网格</a></li>
</ul>
</li>
<li><a href="#input">Input游戏对象的输入控制</a></li>
<li><a href="#scene">Scene场景</a><ul>
<li><a href="#sceneadd">Scene.add属性</a></li>
<li><a href="#scenemake">Scene.make属性</a></li>
<li><a href="#scenechildren">Scene.children显示列表</a></li>
<li><a href="#sceneanims">Scene.anims动画管理器</a></li>
<li><a href="#scenetime">Scene.time时钟</a></li>
<li><a href="#scenetweens">Scene.tweens补间动画管理器</a></li>
<li><a href="#scenecache">Scene.cache缓存管理器</a></li>
<li><a href="#scenecameras">Scene.cameras镜头管理器</a></li>
<li><a href="#sceneevents">Scene.events事件发生器</a></li>
<li><a href="#scenegamegame">Scene.game(Game)</a></li>
<li><a href="#sceneinput">Scene.input输入插件</a></li>
<li><a href="#scenelights">Scene.lights灯光管理器</a></li>
<li><a href="#sceneload">Scene.load资源加载插件</a></li>
<li><a href="#sceneimpact-impact">Scene.impact Impact物理引擎</a></li>
<li><a href="#scenematter-zatter">Scene.matter Zatter物理引擎</a></li>
<li><a href="#scenephysics-arcade">Scene.physics Arcade物理引擎</a></li>
<li><a href="#sceneplugins">Scene.plugins插件管理器</a></li>
<li><a href="#scenefacebook-facebook">Scene.facebook Facebook即时游戏插件</a></li>
<li><a href="#sceneregistry">Scene.registry数据管理器</a></li>
<li><a href="#scenedata">Scene.data数据管理器</a></li>
<li><a href="#scenescene">Scene.scene场景插件</a></li>
<li><a href="#scenesound">Scene.sound基础声音管理器</a></li>
<li><a href="#scenesys">Scene.sys系统</a></li>
<li><a href="#scenetextures">Scene.textures纹理管理器</a></li>
</ul>
</li>
<li><a href="#_3">生成碰撞、重叠管理对象</a></li>
<li><a href="#input_1">Input生成输入管理对象</a></li>
<li><a href="#gameresize">调整尺寸Game.resize</a></li>
<li><a href="#game">销毁Game实例</a></li>
<li><a href="#src">src文件结构（最佳实践）</a></li>
<li><a href="#math">Math数学</a><ul>
<li><a href="#rnd">RND随机数</a></li>
</ul>
</li>
<li><a href="#_4">对象对齐（定位）</a></li>
<li><a href="#actions">Actions动作（批处理）</a></li>
</ul>
</div>
                </nav>                
            </ul>
            </div>
        
        <hr>

    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="/archives.html">Archives</a>
                <li><a href="/tags.html">Tags</a>




            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="/category/bu-kao-si-ji.html">布考斯基</a></li>
                <li><a href="/category/qi-ji-yin-qiao-zhi.html">奇技淫巧志</a></li>
                <li><a href="/category/xi-phaser.html">习Phaser</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="http://www.xiiigame.com/example">拼字游戏</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://github.com/Fusyong">GitHub</a></li>
                <li><a href="https://www.phaser-china.com/">Phaser小站</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="">嬉戏实验室</a> &copy; 黄复雄 2018, Powered by <a href="http://getpelican.com/">Pelican</a></p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="/theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-105243279-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
<a href="https://github.com/Fusyong"><img style="position: absolute; top: 40px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
 
</body>
</html>